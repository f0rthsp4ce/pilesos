version: '3'

services:
  
  pilesos:
    build: .
    container_name: pilesos
    # live code reload
    volumes:
      - ./pilesos:/app/pilesos
    ports:
      - "80:8000"
    devices:
      - /dev/ttyAMA1

  ustreamer:
    container_name: ustreamer
    image: pikvm/ustreamer:latest
    command: --host=0.0.0.0 \
             --port=8001 \
             --allow-origin=\* \
             --device=/dev/video0 \
             --device-timeout=5 \
             --workers=4 \
             --encoder=HW \
             --resolution=480x240 \
             --quality=80
    ports:
      - "8001:8001"
    devices:
      - /dev/video0
    stop_grace_period: 1s
